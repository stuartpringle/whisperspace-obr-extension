import"./modulepreload-polyfill-B5Qt9EMX.js";import{O as n}from"./vendor_obr-BLY5dk8V.js";import{v as T,A as _,B as x,M,C as S,i as b,m as A,s as D,j as O,b as N,a as F,u as U}from"./statusEffects-DyppbTlk.js";import"./vendor-CPvQcOsy.js";import"./vendor_zod-CxP395f9.js";const f="com.whisperspace.sheet",$=`${f}/context/open-sheet`,H=`${f}/popover/open-sheet`,L=`${f}/context/roll-initiative`;async function P(){await n.onReady(async()=>{await n.contextMenu.create({id:$,icons:[{icon:"/icon.svg",label:"Open Whisperspace Sheet",filter:{min:1,max:1,every:[{key:"layer",value:"CHARACTER"}]}}],onClick:async(r,i)=>{var a;const s=(a=r.items)==null?void 0:a[0],c=s==null?void 0:s.id;c&&(await T(c),await n.popover.open({id:H,url:"/",height:720,width:520,anchorElementId:i,anchorReference:"ELEMENT"}))}}),await n.contextMenu.create({id:L,icons:[{icon:"/icon.svg",label:"Roll Initiative",filter:{min:1,max:1,every:[{key:"layer",value:"CHARACTER"}]}}],onClick:async r=>{var u,m,p,E;const i=(u=r.items)==null?void 0:u[0],s=i==null?void 0:i.id;if(!s)return;if(((await _()).entries??[]).some(e=>e.tokenId===s)){await x(s);return}const[a]=await n.scene.items.getItems([s]),d=(m=a==null?void 0:a.metadata)==null?void 0:m[M],t=S(d);if(!t)return;const o=[];(t.inventory??[]).forEach(e=>{typeof(e==null?void 0:e.statusEffects)=="string"&&e.statusEffects.trim()&&o.push(e.statusEffects)}),(t.feats??[]).forEach(e=>{typeof(e==null?void 0:e.statusEffects)=="string"&&e.statusEffects.trim()&&o.push(e.statusEffects)}),typeof(t==null?void 0:t.statusEffects)=="string"&&t.statusEffects.trim()&&o.push(t.statusEffects);const l=b(o),v=A(t.skills??{},D.inherent??[]),h=(l.deltas.ref??0)+(l.deltas.reflex??0),I=Math.max(0,v.ref+h),y=O(t.skills??{}),w=Math.max(0,y+(l.deltas.cool_under_fire??0)),R=(((p=t.stress)==null?void 0:p.current)??0)>w,g=N({modifier:I,label:`${t.name} Initiative`,netDice:R?-1:0}),k=await F({diceNotation:g,rollTarget:"everyone",showResults:!0}),C=(E=a==null?void 0:a.image)==null?void 0:E.url;await U({tokenId:s,name:t.name,thumbUrl:C,initiative:k})}})})}P();
