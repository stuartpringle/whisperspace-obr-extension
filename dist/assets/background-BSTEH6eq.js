import{v as R,A as S,B as b,M as k,C as O,i as T,m as D,j as C,b as N,a as A,u as F}from"./statusEffects-BW_hrCqQ.js";import{O as n}from"./vendor_obr-BLY5dk8V.js";import"./vendor_zod-CxP395f9.js";import"./vendor-CPvQcOsy.js";const l="com.whisperspace.sheet",U=`${l}/context/open-sheet`,$=`${l}/popover/open-sheet`,L=`${l}/context/roll-initiative`;async function P(){await n.onReady(async()=>{await n.contextMenu.create({id:U,icons:[{icon:"/icon.svg",label:"Open Whisperspace Sheet",filter:{min:1,max:1}}],onClick:async(r,a)=>{var i;const s=(i=r.items)==null?void 0:i[0],c=s==null?void 0:s.id;c&&(await R(c),await n.popover.open({id:$,url:"/",height:720,width:520,anchorElementId:a,anchorReference:"ELEMENT"}))}}),await n.contextMenu.create({id:L,icons:[{icon:"/icon.svg",label:"Roll Initiative",filter:{min:1,max:1}}],onClick:async r=>{var u,m,p,d;const a=(u=r.items)==null?void 0:u[0],s=a==null?void 0:a.id;if(!s)return;if(((await S()).entries??[]).some(e=>e.tokenId===s)){await b(s);return}const[i]=await n.scene.items.getItems([s]),E=(m=i==null?void 0:i.metadata)==null?void 0:m[k],t=O(E);if(!t)return;const o=[];(t.inventory??[]).forEach(e=>{typeof(e==null?void 0:e.statusEffects)=="string"&&e.statusEffects.trim()&&o.push(e.statusEffects)}),(t.feats??[]).forEach(e=>{typeof(e==null?void 0:e.statusEffects)=="string"&&e.statusEffects.trim()&&o.push(e.statusEffects)}),typeof(t==null?void 0:t.statusEffects)=="string"&&t.statusEffects.trim()&&o.push(t.statusEffects);const f=T(o),h=D(t.skills??{}),v=(f.deltas.ref??0)+(f.deltas.reflex??0),I=Math.max(0,h.ref+v),w=C(t.skills??{}),g=Math.max(0,w+(f.deltas.cool_under_fire??0)),y=(((p=t.stress)==null?void 0:p.current)??0)>g,_=N({modifier:I,label:`${t.name} Initiative`,netDice:y?-1:0}),x=await A({diceNotation:_,rollTarget:"everyone",showResults:!0}),M=(d=i==null?void 0:i.image)==null?void 0:d.url;await F({tokenId:s,name:t.name,thumbUrl:M,initiative:x})}})})}P();
